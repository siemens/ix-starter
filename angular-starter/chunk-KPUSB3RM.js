import{b as v}from"./chunk-3AB2V46W.js";import{a as H,b as C}from"./chunk-IAEY3YVY.js";import{a as E,d as w,e as P,f as I,g as _}from"./chunk-GG4ZXK7F.js";import{f as b}from"./chunk-S5EYVFES.js";var u=l=>!Number.isNaN(Number(l)),S=(l,n)=>{l.classList.add(n)},T=(()=>{class l{static create(e,i=l.defaultConfig){return new l(e,i)}static mergeStyle(e,i){for(let t in i)e.style[t]!==i[t]&&(e.style[t]=i[t])}static getMaxBrowserHeight(){let e=document.createElement("div"),i=document.createElement("div");l.mergeStyle(e,{position:"absolute",height:"1px",opacity:0}),l.mergeStyle(i,{height:"1e7px"}),e.appendChild(i),document.body.appendChild(e);let t=i.offsetHeight;return document.body.removeChild(e),t}constructor(e,i){this._lastRepaint=null,this._maxElementHeight=l.getMaxBrowserHeight(),this.refresh(e,i);let t=this._config,s=()=>{let r=this._getScrollPosition(),o=this._lastRepaint;if(this._renderAnimationFrame=window.requestAnimationFrame(s),r===o)return;let a=o?r-o:0;if(!o||a<0||a>this._averageHeight){let h=this._renderChunk();this._lastRepaint=r,h!==!1&&typeof t.afterRender=="function"&&t.afterRender()}};s()}destroy(){window.cancelAnimationFrame(this._renderAnimationFrame)}refresh(e,i=l.defaultConfig){if(this._config=i,!e||e.nodeType!==1)throw new Error("HyperList requires a valid DOM Node container");this._element=e;let t=this._config,s=this._scroller||t.scroller||document.createElement(t.scrollerTagName||"tr");if(typeof t.useFragment!="boolean"&&(this._config.useFragment=!0),!t.generate)throw new Error("Missing required `generate` function");if(!u(t.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(t.itemHeight)&&!u(t.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());u(t.itemHeight)?this._itemHeights=Array(t.total).fill(t.itemHeight):this._itemHeights=[t.itemHeight],Object.keys(l.defaultConfig).filter(m=>m in t).forEach(m=>{let f=t[m],x=u(f);if(f&&typeof f!="string"&&typeof f!="number"){let y=`Invalid optional \`${m}\`, expected string or number`;throw new Error(y)}else x&&(t[m]=`${f}px`)});let r=!!t.horizontal,o=t[r?"width":"height"];if(o){let m=u(o),f=m?!1:o.slice(-1)==="%",x=parseInt(m?o:o.replace(/px|%/,""),10),y=window[r?"innerWidth":"innerHeight"];f?this._containerSize=y*x/100:this._containerSize=u(o)?o:x}let a=t.scrollContainer,h=t.itemHeight*t.total,c=this._maxElementHeight;h>c&&console.warn(["HyperList: The maximum element height",c+"px has","been exceeded; please reduce your item height."].join(" "));let d={width:`${t.width}`,height:a?`${h}px`:`${t.height}`,overflow:a?"none":"auto",position:"relative"};l.mergeStyle(e,d),a&&l.mergeStyle(t.scrollContainer,{overflow:"auto"});let g={opacity:"0",position:"absolute",[r?"height":"width"]:"1px",[r?"width":"height"]:`${h}px`};l.mergeStyle(s,g),this._scroller||e.appendChild(s);let p=this._computeScrollPadding();this._scrollPaddingBottom=p.bottom,this._scrollPaddingTop=p.top,this._scroller=s,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(t.total).fill(0),this._computePositions(0),this._renderChunk(this._lastRepaint!==null),typeof t.afterRender=="function"&&t.afterRender()}_getRow(e){let i=this._config,t=i.generate(e),s=t.height;if(s!==void 0&&u(s)?(t=t.element,s!==this._itemHeights[e]&&(this._itemHeights[e]=s,this._computePositions(e),this._scrollHeight=this._computeScrollHeight())):s=this._itemHeights[e],!t||t.nodeType!==1)throw new Error(`Generator did not return a DOM Node for index: ${e}`);S(t,i.rowClassName||"vrow");let r=this._itemPositions[e]+this._scrollPaddingTop;return l.mergeStyle(t,{position:"absolute",[i.horizontal?"left":"top"]:`${r}px`}),t}_getScrollPosition(){let e=this._config;return typeof e.overrideScrollPosition=="function"?e.overrideScrollPosition():this._element[e.horizontal?"scrollLeft":"scrollTop"]}_renderChunk(e=!1){let i=this._config,t=this._element,s=this._getScrollPosition(),r=i.total,o=this._getFrom(s)-1;if((o<0||o-this._screenItemsLen<0)&&(o=0),!e&&this._lastFrom===o)return!1;this._lastFrom=o;let a=o+this._cachedItemsLen;(a>r||a+this._cachedItemsLen>r)&&(a=r);let h=i.useFragment?document.createDocumentFragment():[],c=this._scroller;h[i.useFragment?"appendChild":"push"](c);for(let d=o;d<a;d++){let g=this._getRow(d);h[i.useFragment?"appendChild":"push"](g)}if(i.applyPatch)return i.applyPatch(t,h);t.innerHTML="",t.appendChild(h)}_computePositions(e=1){let t=this._config.total;e<1&&(e=1);for(let s=e;s<t;s++)this._itemPositions[s]=this._itemHeights[s-1]+this._itemPositions[s-1]}_computeScrollHeight(){let e=this._config,i=!!e.horizontal,t=e.total,s=this._itemHeights.reduce((g,p)=>g+p,0)+this._scrollPaddingBottom+this._scrollPaddingTop;l.mergeStyle(this._scroller,{opacity:0,position:"absolute",top:"0px",[i?"height":"width"]:"1px",[i?"width":"height"]:`${s}px`});let r=this._itemHeights.slice(0).sort((g,p)=>g-p),o=Math.floor(t/2),a=t%2===0?(r[o]+r[o-1])/2:r[o],h=i?"clientWidth":"clientHeight",c=e.scrollContainer?e.scrollContainer:this._element,d=c[h]?c[h]:this._containerSize;return this._screenItemsLen=Math.ceil(d/a),this._containerSize=d,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3),this._averageHeight=a,s}_computeScrollPadding(){let i=!!this._config.horizontal,t=window.getComputedStyle(this._element),s=r=>{let o=t.getPropertyValue(`padding-${r}`);return parseInt(o,10)||0};return i?{bottom:s("right"),top:s("left")}:{bottom:s("bottom"),top:s("top")}}_getFrom(e){let i=0;for(;this._itemPositions[i]<e;)i++;return i}}return l.defaultConfig={width:"100%",height:"100%"},l})(),R=":host{display:block}",F=(()=>{let l=class{constructor(n){E(this,n),this.contextChange=_(this,"contextChange",7),this.nodeToggled=_(this,"nodeToggled",7),this.nodeClicked=_(this,"nodeClicked",7),this.nodeRemoved=_(this,"nodeRemoved",7),this.root="root",this.model={},this.context={},this.updates=new Map,this.hasFirstRender=!1,this.dirtyItems=new Set}updatePadding(n,e){n.style.paddingLeft=e.level+"rem"}getVirtualizerOptions(n){let e=this.buildTreeList(this.model[this.root]);return{width:"100%",height:"100%",itemHeight:32,total:e.length,generate:i=>{let t=e[i],s=this.hostElement.querySelector(`[data-tree-node-id="${t.id}"]`),r=this.getContext(t.id);if(s&&n.force===!1){s.hasChildren=t.hasChildren,s.context=Object.assign({},r);let c=this.dirtyItems.has(t.id);if(this.updates.has(t.id)){let d=this.updates.get(t.id);if(d){let g=d(t,Object.assign({},this.context));typeof g=="boolean"&&(c=g)}}if(this.updatePadding(s,t),!c)return s}let o=c=>{this.updates.set(t.id,c)},a=null;this.renderItem&&(a=this.renderItem(i,t,e,Object.assign({},this.context),o)),a===null&&(a=H(t,r,o));let h=a;return h.setAttribute("data-tree-node-id",t.id),h.style.paddingRight="1rem",this.updatePadding(h,t),this.dirtyItems.delete(t.id),h}}}setContext(n,e){this.context=Object.assign(Object.assign({},this.context),{[n]:e}),this.contextChange.emit(this.context)}getContext(n){return this.context?(this.context[n]||(this.context[n]={isExpanded:!1,isSelected:!1}),this.context[n]):{isExpanded:!1,isSelected:!1}}buildTreeList(n,e=0){let i=[];if(n?.hasChildren){let t=e+1;n.children.forEach(s=>{let r=this.model[s],o=this.getContext(s);i.push(Object.assign(Object.assign({},r),{level:e})),r.hasChildren&&o.isExpanded&&i.push(...this.buildTreeList(r,t))})}return i}componentDidLoad(){this.initList(),this.observer=new MutationObserver(n=>{let e=[];n.forEach(i=>{e=[...e,...Array.from(i.removedNodes)],i.addedNodes.forEach(t=>{let s=e.indexOf(t);s>=0&&e.splice(s,1)})}),this.nodeRemoved.emit(e)}),this.observer.observe(this.hostElement,{childList:!0})}componentWillRender(){this.hasFirstRender=!0,this.isListInitialized()?this.refreshTree():this.initList()}connectedCallback(){this.hasFirstRender&&this.initList()}disconnectedCallback(){var n,e;(n=this.hyperlist)===null||n===void 0||n.destroy(),(e=this.observer)===null||e===void 0||e.disconnect()}onModelChange(){this.hasFirstRender&&!this.isListInitialized()&&this.initList()}markItemsAsDirty(n){return b(this,null,function*(){n.forEach(e=>this.dirtyItems.add(e))})}isListInitialized(){var n;let e=(n=this.hyperlist)===null||n===void 0?void 0:n._itemPositions;return e!==void 0&&e.length&&!e?.some(i=>i===void 0||Number.isNaN(i))}refreshTree(){return b(this,arguments,function*(n=C){this.hyperlist&&this.hyperlist.refresh(this.hostElement,this.getVirtualizerOptions(n))})}initList(){var n;if(!this.model)return;(n=this.hyperlist)===null||n===void 0||n.destroy();let e=this.getVirtualizerOptions(C);this.hyperlist=new T(this.hostElement,e)}onToggle(n){let{target:e}=n;if(n.preventDefault(),n.stopPropagation(),!(e instanceof HTMLElement))return;let i=e.getAttribute("data-tree-node-id");if(!i||!this.model[i].hasChildren)return;let s=this.getContext(i);s.isExpanded=!s.isExpanded,this.nodeToggled.emit({id:i,isExpanded:s.isExpanded}),this.setContext(i,s)}onTreeItemClick(n){let{target:e}=n;if(!(e instanceof HTMLElement))return;let i=e.getAttribute("data-tree-node-id");if(!i)return;let t=this.model[i],s=n.composedPath(),r=s.indexOf(this.hostElement),o=s.slice(0,r);if(!v.pathIncludesTrigger(o)){if(!n.defaultPrevented){Object.values(this.context).forEach(c=>c.isSelected=!1);let h=this.getContext(i);h.isSelected=!0,this.setContext(i,h)}if(this.toggleOnItemClick&&t.hasChildren){let h=this.getContext(i);h.isExpanded=!h.isExpanded,this.nodeToggled.emit({id:i,isExpanded:h.isExpanded}),this.setContext(i,h)}this.nodeClicked.emit(i)}}render(){return w(P,{key:"1ef871a4ff980e0e231e1fb2544444d49318612c",onClick:n=>this.onTreeItemClick(n)},w("slot",{key:"00178bcb7596a1f28f24df7bda0bac88d7455b00"}))}get hostElement(){return I(this)}static get watchers(){return{model:["onModelChange"]}}};return l.style=R,l})();export{F as ix_tree};
